package es.us.dp1.l4_04_24_25.saboteur.activePlayer;

import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.query.Param;
import java.util.List;
import java.util.Optional;

public interface ActivePlayerRepository extends CrudRepository<ActivePlayer, Integer> {

    // Para encontrar ActivePlayers por partida (Game) - a través de la relación games (que es una lista de games en ActivePlayer)
    @Query("SELECT ap FROM ActivePlayer ap JOIN ap.games g WHERE g.id = :gameId")
    List<ActivePlayer> findByGameId(@Param("gameId") Integer gameId);

    // Para encontrar ActivePlayers por rol
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.rol = :rol")
    List<ActivePlayer> findByRol(@Param("rol") boolean rol);

    // Para obtener el creador de una partida
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.createdGame.id = :gameId")
    Optional<ActivePlayer> findCreatorByGameId(@Param("gameId") Integer gameId);

    // Para encontrar el ganador de una partida
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.wonGame.id = :gameId")
    Optional<ActivePlayer> findWinnerByGameId(@Param("gameId") Integer gameId);

    // Para encontrar ActivePlayers por estado del pico
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.pickaxeState = :pickaxeState")
    List<ActivePlayer> findByPickaxeState(@Param("pickaxeState") boolean pickaxeState);

    // Para encontrar ActivePlayers por estado de la vela
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.candleState = :candleState")
    List<ActivePlayer> findByCandleState(@Param("candleState") boolean candleState);

    // Para encontrar ActivePlayers por estado del carro
    @Query("SELECT ap FROM ActivePlayer ap WHERE ap.cartState = :cartState")
    List<ActivePlayer> findByCartState(@Param("cartState") boolean cartState);

} 